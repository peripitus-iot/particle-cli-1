{"version":3,"sources":["../src/protobuf-util.js"],"names":["fromProtobufEnum","pbEnum","map","unknownVal","mapToProtobuf","mapFromProtobuf","funcs","toProtobuf","val","pbVal","toLowerCase","undefined","RangeError","fromProtobuf","obj","pbName","Error","v","transformMessage","msg","name","m","value","checkFromProtobufMessageMap","pbMsgProto","Object","prototype","hasOwnProperty","call","checkToProtobufMessageMap","assignMessagePropertyMaps","maps","reduce","fromProtobufMessage","pbMsg","toProtobufMessage"],"mappings":"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","sourcesContent":["// Transforms a Protobuf enum to an API object according to the provided mapping. Resulting object\n// provides functions for a checked conversion between the protocol and API values\nexport function fromProtobufEnum(pbEnum, map, unknownVal) {\n\tconst mapToProtobuf = {};\n\tconst mapFromProtobuf = {};\n\tconst funcs = {\n\t\ttoProtobuf: (val) => {\n\t\t\tconst pbVal = mapToProtobuf[val.toLowerCase()];\n\t\t\tif (pbVal === undefined) {\n\t\t\t\tthrow new RangeError(`Invalid value: ${val}`);\n\t\t\t}\n\t\t\treturn pbVal;\n\t\t},\n\t\tfromProtobuf: (pbVal) => {\n\t\t\tconst val = mapFromProtobuf[pbVal];\n\t\t\tif (val === undefined) {\n\t\t\t\treturn (unknownVal !== undefined ? unknownVal : 'UNKNOWN');\n\t\t\t}\n\t\t\treturn val;\n\t\t}\n\t};\n\tconst obj = Object.create(funcs);\n\tfor (let val in map) {\n\t\tconst pbName = map[val];\n\t\tconst pbVal = pbEnum[pbName];\n\t\tif (pbVal === undefined) {\n\t\t\tthrow new Error(`Unknown enum value: ${pbName}`);\n\t\t}\n\t\tconst v = val.toLowerCase();\n\t\tif (v in mapToProtobuf) {\n\t\t\tthrow new Error(`Duplicate value: ${val}`);\n\t\t}\n\t\tmapToProtobuf[v] = pbVal;\n\t\tmapFromProtobuf[pbVal] = val;\n\t\tobj[val] = val;\n\t}\n\treturn Object.freeze(obj);\n}\n\nfunction transformMessage(msg, map) {\n\tconst obj = {};\n\tfor (let name of Object.keys(msg)) { // Ignore prototype properties\n\t\tlet val = msg[name];\n\t\tconst m = map[name];\n\t\tif (typeof m == 'string') {\n\t\t\tname = m; // Rename property\n\t\t} else if (typeof m == 'function') {\n\t\t\tval = m(val); // Convert value\n\t\t} else if (typeof m == 'object') {\n\t\t\tif (m.name) {\n\t\t\t\tname = m.name; // Rename property\n\t\t\t}\n\t\t\tif (m.value) {\n\t\t\t\tval = m.value(val); // Convert value\n\t\t\t}\n\t\t} else if (!m) {\n\t\t\tcontinue; // Skip property\n\t\t}\n\t\tif (val === undefined) {\n\t\t\tcontinue; // Skip property\n\t\t}\n\t\tobj[name] = val;\n\t}\n\treturn obj;\n}\n\nfunction checkFromProtobufMessageMap(pbMsgProto, map) {\n\tfor (let name in map) {\n\t\tif (!Object.prototype.hasOwnProperty.call(pbMsgProto, name)) {\n\t\t\tthrow new Error(`Unknown message field: ${name}`);\n\t\t}\n\t}\n}\n\nfunction checkToProtobufMessageMap(pbMsgProto, map) {\n\tfor (let name in map) {\n\t\tconst m = map[name];\n\t\tif (typeof m == 'string') {\n\t\t\tname = m;\n\t\t} else if (typeof m == 'object') {\n\t\t\tif (m.name) {\n\t\t\t\tname = m.name;\n\t\t\t}\n\t\t}\n\t\tif (!Object.prototype.hasOwnProperty.call(pbMsgProto, name)) {\n\t\t\tthrow new Error(`Unknown message field: ${name}`);\n\t\t}\n\t}\n}\n\nfunction assignMessagePropertyMaps(obj, ...maps) {\n\tfor (let map of maps) {\n\t\tif (Array.isArray(map)) {\n\t\t\tmap = map.reduce((obj, name) => {\n\t\t\t\tobj[name] = true;\n\t\t\t\treturn obj;\n\t\t\t}, {});\n\t\t}\n\t\tObject.assign(obj, map);\n\t}\n\treturn obj;\n}\n\n// Returns a function that transforms a Protobuf message to an API object according to the provided mapping\nexport function fromProtobufMessage(pbMsg, ...maps) {\n\tconst map = assignMessagePropertyMaps({}, ...maps);\n\tcheckFromProtobufMessageMap(pbMsg.prototype, map);\n\treturn msg => transformMessage(msg, map);\n}\n\n// Returns a function that transforms an API object to a Protobuf message according to the provided mapping\nexport function toProtobufMessage(pbMsg, ...maps) {\n\tconst map = assignMessagePropertyMaps({}, ...maps);\n\tcheckToProtobufMessageMap(pbMsg.prototype, map);\n\treturn msg => transformMessage(msg, map);\n}\n"],"file":"protobuf-util.js"}